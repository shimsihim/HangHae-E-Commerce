# 카프카 구성요소 정리

## Broker
카프카가 설치된 서버. 실제로 메시지를 저장하고 관리하는 역할을 한다.  
여러 대의 Broker를 클러스터로 묶어서 사용할 수 있다.


## Topic
메시지를 분류하는 단위. 메시지가 저장되는 이름.  
Producer는 특정 Topic으로 메시지를 보내고, Consumer는 특정 Topic에서 메시지를 가져간다.


## Partition
Topic을 물리적으로 나눈 것. 하나의 Topic이 여러 개의 Partition으로 나뉠 수 있음.  
Partition이 여러 개면 메시지를 병렬로 처리할 수 있어서 처리량이 늘어난다.  

메시지는 Key를 기준으로 특정 Partition으로 보내진다.
같은 Key를 가진 메시지는 항상 같은 Partition으로 가서 순서가 보장됨.


## Producer
메시지를 Kafka로 보내는 발행하는 곳.
Topic을 지정해서 메시지를 publish 한다.


## Consumer
Kafka에서 메시지를 수신하는 곳.
특정 Topic을 subscribe 해서 메시지를 받아온다.

## Comsumer Group
컨슈머들을 하나의 팀으로 묶은 것.    
같은 그룹에 속한 Consumer들은 Partition을 나눠서 처리함.  
그룹이 다르다면 같은 토픽의 메시지에 대해서 별도로 처리(오프셋 별도)


## Offset
Consumer가 어디까지 메시지를 읽었는지 기록하는 위치값.
Partition 내에서 메시지마다 고유한 번호가 매겨지는데 그게 Offset임.


## Replication
서버 한 대가 고장 나도 데이터가 사라지지 않게 만드는 복제본   
리더 : 모든 읽기와 쓰기 작업은 리더 파티션에서만 일어남  
팔로워 : 리더의 데이터를 그대로 복사해서 들고 있는 백업용  
ISR : 리더와 데이터를 잘 동기화하고 있는 팔로워들의 그룹. 리더가 죽으면 이 중에서 새로운 리더가 선출  

## Rebalancing
그룹에 컨슈머가 새로 들어오거나 한 명이 나가면, 또는 특정 컨슈머의 오랫동안 메시지를 안 가져갈 시  
파티션을 누구에게 맡길지 다시 정하는 과정. 이때 잠시 데이터 처리가 멈출 수 있으니 주의


## 참고사항
- Kafka는 메시지를 디스크에 저장하기 때문에 Consumer가 메시지를 가져가도 삭제되지 않음
- 설정된 보관 기간 동안 메시지가 남아있어서 나중에 다시 읽을 수도 있음
